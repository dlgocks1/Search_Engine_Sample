Mitsugu Oyama のソフトウェア倉庫 > コラム一覧  > Firefox Extension のセキュリティ向上に関する考察
以前書いた "Firefox 拡張配布に係る諸問題" という論考において、AMO からの拡張のダウンロードでさえ、ユーザの安全は担保されないと書いた。
それ以降、自分なりの回答を見つけるべくいろいろ考えていたが、非常に残念なことに "配布方法にフォーカスし続ける限り、拡張のセキュリティ向上は望めない" との結論に至らざるを得なかった。
"Firefox 拡張配布に係る諸問題" にて AMO においても以下のような問題があることを明らかにした。
AMO 登録時には拡張のコード・チェックは一切されない ( 登録≠公開：公開、すなわちサンドボックスから出される時のみスタッフによりコード・チェックされる )
"この実験的なアドオンをインストールします。" のチェック・ボックスにチェックを入れさえすれば、たとえ悪意ある拡張でも簡単にインストールできてしまう
AMO に登録されている全ての拡張を、わずか数人のアクティブ・レビューワで精査するのは不可能である
さらに AMO に限らず、ネットワーク・セキュリティ上の懸案事項として以下のようなものが存在する。
拡張に署名を施したとしても、証明書が正規のものである保証がない
当り前の話だが署名は拡張の安全性を担保するものではまったくない
証明書としての機能を有しないオレオレ証明書のような怪しげな証明書が世の中には数多く存在する ( そういった怪しげな証明書を行政機関が平気で発行していたりもする )
Verisign のような信頼された証明書発行機関により発行された正規の証明書を利用した攻撃が普通に存在している ( 悪意ある人間の証明書発行申請が通るケース )
そもそもユーザは証明書の中身をチェックしないし、チェックしても内容を理解するのは非常に困難である
フィッシング・サイトに誘導されたら SSL も無力である
FTP パスワードが盗聴され、サイト改竄によりユーザが攻撃されれば SSL も無力である
DNS がクラックされ、攻撃サイトに誘導されたら SSL も無力である
以上の課題は、なにも Firefox の拡張に限った話ではなく、インターネットに接続されたありとあらゆる機器に共通する課題である。
むろん証明書の添付が不要だとか、SSL は不要であるとか暴論を展開するつもりはない。これらはセキュリティ向上のための必要条件であって、これらを省くことが望ましくない結果をもたらすことは論を待たない。しかしこれだけでは十分条件を満たすことはできない。
結論を先に述べてしまうと、セキュリティを 100% 担保する技術的方法論は存在しない。しかし必要条件に強力な項目を加えることはできる。
セキュア OS で実装されているような強制アクセス制御と最小特権の Firefox への実装である。
現在の Firefox の仕様では、各拡張は Firefox がアクセス可能なあらゆる資源にアクセスできる。それがゆえに拡張はユーザにとって非常に便利なものであり、Firefox というブラウザを魅力的なものにしている。しかしその利便性はユーザリスク増加とのトレードオフとなっている。
Firefox が拡張に対して強制アクセス制御と最小特権の機能を持つようになれば、それぞれの拡張が Firefox 経由で無制限にローカルならびにリモートの資源にアクセスすることを抑止することができる。そうなれば悪意ある拡張によるユーザへの攻撃の多くは失敗に終わるはずである。
強制アクセス制御や最小特権はなにもかもを禁止するような仕組みではない。ポリシーに記述されている以外のアクセスを行えないようにする仕組みである ( 詳しいことを知りたい場合は "セキュア OS" で調べていただきたい )。
筆者は最低でも以下のオブジェクトへの強制アクセス制御と最小特権を Firefox にインプリメントする必要を感じている。
Firefox 本体の各種オブジェクト
URI
XPConnect、XPCOM の各種オブジェクト
XMLHttpReauest オブジェクト
その他
これらのオブジェクトに拡張がアクセスするにはポリシーを記述しなければならないようにするのだ。そうすることで以下のようなことが期待できる。
ポリシーに記載のない動作を各拡張が行うことができないので、各拡張の動作が厳格に定義される
ポリシーを拡張のインストール時に強制的に表示すれば ( 不正な証明書を検出した時のように )、ユーザ・セキュリティ・リスクの低減が期待できる
ユーザがポリシーをいつでも参照できるようにすれば、ユーザ・セキュリティ・リスクの低減が期待できる
AMO のコード・レビューワがコードそものもを精査する必要がなくなり、ポリシーをチェックするだけでよくなる
AMO のコード・レビューワの負担が軽減する
AMO 以外の場所で配布される拡張の使用も、安全性がある程度、しかしかなりの強度で向上する
既存拡張はコードの変更がおそらくはほとんど必要なく、ポリシーを追加するだけで機能する
拡張の発表場所を AMO に限定する必要がなくなる ( AMO で "公開" されるには、未だに拡張作者の心が砕けてしまうくらい非常に高い敷居を乗り越えなければならない )
一方で Firefox への強制アクセス制御や最小特権の導入には課題も存在する。
ポリシーをパソコン・ビギナーでも理解可能なフォーマットで提示する必要がある
強制アクセス制御技術へのユーザの理解が向上するようにしなければならない ( SELinux の時のように、機能を off にするノウハウが最初に流通するような事態は、なんとしても避けなければならない )
Firefox 本体のバイナリ・コードから JavaScript コード、XUL、etc に至るまでポリシーを記述しなければならず、拡張作者の負担が若干増加する
強制アクセス制御の導入が Firefox のパフォーマンス低下を招いてはならない
JavaScript の言語仕様により、Firefox 本体の JavaScript オブジェクトへの強制アクセス制御の実装が非常に困難である
以上見てきたように Firefox への強制アクセス制御や最小特権の導入には少なからぬ、また技術的に困難な課題も存在する。さらには強制アクセス制御や最小特権の導入により Firefox が 100% セキュアになるわけでもない ( 100% セキュアな環境など存在し得ない )。しかし現状の AMO での配布やデジタル署名による低いセキュリティよりははるかに強固なセキュア環境が構築される。