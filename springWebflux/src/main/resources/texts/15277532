意図せず他人のモデムにアクセスしまう
Yahoo!BBのADSLモデムは、telnet、ブラウザ、ハイパーターミナルで
アクセスすることにより、ステータスの参照、および設定変更が可能になっているが、
Yahoo!BBは公開していない。
ことの始まりは２ちゃんねるプロバイダ板の
「YBBモデムをルーターに」スレッド。
Yahoo!BBモデムの原型はAMBIT製のADSLルータであり、ルータとくれば設定を覗いて
みたくなるもの。telnetでアクセスしてみるとパスワード入力を促されるが、これがわからない。
ちょうど同じ時期にファームウェアのアップデート版がYahoo!BBからリリースされた。
このファイルを展開するとdata.packというバイナリファイルがあるが、ここに、
という生テキストがある。snmpのcommunityだが、telnetのパスワードも同じ。あのスレッドで
パスワードを公表した人は、このファイルを見たか、ファームアップデートの際、パケットを
モニタしたのか．．．いずれにしても、2001年10月12日 パスワードが発見された。
このスレッドを追っていくと、174 の投稿で、
「リンクスピードの表示が接続の度に違う。よそ様のモデムに接続してしまったか？」という
内容の投稿がある。今から思えば、これが「他人のモデムにアクセス」問題の発端であった。
当時、私の環境はメンテナンス前であり、サブネット間の
通信は遮断されていたので、このような問題にお目に掛かることはなかったし、このスレッドの
趣旨は「ブリッヂモデムをルータに」ということなので誰も突っ込んではいない。
私も気にはとめなかったし、リンク速度がわかるだけでも大きな収穫だった。
174を投稿した人の環境がメンテナンス後だったのだろう。
やがて、あっちの掲示板にも
情報が広まったが、「モデムにブラウザでアクセスすると、画面表示が異なるときがある」
「リンクスピードと実効速度が大きく異なる」という投稿も見かけるようになった。
そしてメンテナンスが行われた10月31日、投稿どおりの現象を目にすることになる。
いつもどおり、ブラウザでモデムのリンク速度を表示させると
見慣れない画面。私のモデムはファームウェアのアップデートを行っており、旧ファームの
画面とは大きく異なるのですぐにわかった。間違いなく自分のモデムではない。
サブネット間通信が許可されたネットワークで、モデムのIPアドレスがすべて172.16.255.254。
arp who has 172.16.255.254? に対して返された最初のMACアドレスがarpテーブルにエントリ
されるために起こった現象ということか。
この現象回避とセキュリティのために
などの対策がたてられるが、掲示板では相変わらず他人のモデム
ステータスを参照し、「リンク速度と実効速度が釣り合わない」などの疑問を投げかける投稿が続いた。
のちにモデムステータスを表示するソフトが登場する。
あっちの掲示板で
常に適切な回答を投稿、現在ModemStatus BBS
の神である、「通りすがり!=???」さん作の Modem Telemeter が優れもの。
オプションの yfw と組み合わせれば最強の環境になるのでお勧め。ツールの詳細については、
ModemStatus BBSでどうぞ。
パケット漏れ
一部収容局でTCPのデータ漏れが起きたようだが、私の局では未確認。
外→内の一部パケット漏れは確認できたが、神の推測によると局内Y!BB機器の設定ミス。
n+1.252のルータのARPエントリ更新サイクルがDSLAMのMACアドレス保持期間より長く設定されていて、
本来の下りデータ配信先MACアドレスがDSLAMから消滅した場合に起こり得るとのこと。なるほど納得。
もう一つは初期のCATV同様、同一セグメント内のマシンが見えちゃうという話。
実は、NetBIOSだけではなく、NetBEUI、IPX/SPX（Windows95のデフォルト）、AppleTalkも。
そもそも不要なプロトコルはバインドしないのが基本。
pppの設定ではWindowsが警告とともにバインドしないようになっているのでマシンを覗かれる心配はないが、
意図的にバインドしてしまえば同じこと。
NetBIOS（port137〜139）の問題は、2001年 2月 2日 DSLAM上で遮断する対策がなされたが、
すべての収容局が足並みをそろえてというわけではなかった。DSLAMのファームバージョン更新が
影響していると思われるが、私の局は2002年1月20日以降リブートされていないので、この日に
更新されたと推測する。
偽DHCP疑惑
この問題も有名。「WAN側にDHCPサーバを立ち上げ、ゲートウェイを自分の
マシンに向けることで盗聴可能」ということだが、実際に試したユーザがいたかどうかは不明。
逆に「盗聴したつもりが踏み台にされていた」なんてことにもなるのだが．．．
掲示板で報告された偽DHCP問題は、AirMacに代表される無線ルータでDHCPサーバを設定していた場合、
LAN側・WAN側の区別なくDHCP Discoverパケットに反応してしまうことが原因と考えられている。
この無線ルータだが、私のセグメントにも数台確認できる。ARP who has (10.0.1.1? 192.168.0.1?など)
をブロードキャストすると返事をする。（現在は返ってこない）
今でもAirMacからは、たぶんLAN側255.255.255.255宛に設定されているであろうsyslogがWAN側に飛んでくるし、
NECのAterm WBR75Hは、ルータの設定画面（port:80）にアクセス可能である。
無線LANは便利であるが、こんなものを見てしまうと、ウォードライビングの話もあるし、いまいち信用できない。
偽DHCP（誰が命名したんだっけ？）問題は、NetBIOSと同じタイミングで
遮断（下りDestination port: 67）されたが、同一DSLAMに収容されているMACアドレスの
パケットは相変わらず見えていたので、偽DHCPにつかまる可能性は残されたままだった。
ARP Spoofingによる盗聴
上記３点の問題は、クライアント側で対策することが可能だったが、
この問題は致命的だった。2001年12月にARP Spoofing実験を行い、これが可能であることを確認
した。当時はNetBIOSやDHCP、IP Onlyなフィルタが導入されていなかったので、スイッチによる
社内LANのような構成だったと言える。
この問題が掲示板で明らかにされてしまうと、ルーティングもせずに
パケット横取り状態な厨房が続出 → 全国障害だらけという事態が簡単に予想されたので、
あえて話題にしなかった。
2002年 4月10日 IP or ARPパケットのSource Address フィルタリングを
導入することで上記問題のすべてが解決された。このフィルタリング案は、神が
ModemStatus BBSで一ヶ月
前から提唱していたこと。これまで、「掲示板で問題提起」→「２ちゃんねるに転載、直リンク」→「Y!BBが対策」
を繰り返してきた経緯から、Y!BBの誰かが見ていたに違いない．．．と勝手に思っています。
以降、通行人×はあっちの掲示板を引退。
たま〜に覗いてはいるけど、過去の投稿はログ倉庫に残っているのね。久しぶりに見たら当時が懐かしく
思えた(^^;