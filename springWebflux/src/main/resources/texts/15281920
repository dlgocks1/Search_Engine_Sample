Oracle VMとは、オラクルが提供している無償のサーバ仮想化ソフトウェアである。Xenをベースとしているが、さまざまな機能追加や使いやすさの改善が行われている。本連載では、Oracle VMの製品コンセプトから機能、利用シーンまでを解説する
今回は具体的なRAC on VMの構成図に沿って、その構築手順を見ていきたいと思います。
下の図1は、今回構築する2ノードのRAC on VMの構成例です。詳しくは本文の中で解説していきますが、まずはざっくりと全体のシステム構成を把握していただければと思います。 
完全に冗長化されたRAC on VM構成には、最低でも以下のハードウェアを揃える必要があります。
・サーバ× 2台 
CPU 
特に要件はありませんが、現在のCPU性能／価格を加味すればクアッドコア x 2ソケットくらいが妥当でしょう。 
メモリ 
特に要件はありませんが、最低でも8Gbyte程度、理想的には32Gbyte程度の構成だと最終的にバランスが良く、汎用的だと考えられます。もちろん要件によってはこれ以上の容量を積むケースも考えられます。 
NIC 
最低6ポートのギガビット・イーサネット（GbE）が必要です。これは、後で言及しますが、異なる3つのネットワークセグメントにすべてのNICを冗長化した状態でサーバを接続するためです。 
HDD 
サーバのHDDはほとんど使われないので、できる限り少ない容量のものが良いでしょう。しかし故障してしまうと影響が大きいので2つ以上のドライブをRAID1（ミラーリング）で構成しておくことは不可欠です。
・ストレージ×1台
ファイバチャネル接続、IP接続（iSCSIまたはNFS）の機器を使用できます。今回はiSCSI接続のストレージで話を進めていきます。
・ネットワークスイッチ×2台
VLANが設定可能な機種であれば特段その他の要件はありません。 スタッキングケーブルなどで2台をスタックできるものであれば、なお可です。
1つのRACを構成する仮想マシンは、それぞれ異なる物理サーバ上で起動する必要があります。同一物理サーバ上で1つのRACを構成することは技術的には可能ですが、性能面、可用性においてメリットがないので本番環境では意味を成しません。RACを手軽に構築する検証環境という目的であれば有用ですが、今回はあくまで本番環境での運用が大前提であるため、オラクルから完全にサポートされる構成で話を進めていきます。
ネットワークスイッチが2台必要なのは、1台が故障した際の冗長性を考えてのことです。今回の構成のように、ストレージにIP接続の機器を採用する場合は、RAC on VMには3つのネットワークセグメントが必要になります。
・Public
アプリケーションとDBが通信するためのネットワーク。
・Private
RACノード間通信に利用され、主にメモリ情報を転送するためのネットワーク（インターコネクトと呼ばれる） 。
・Storage
VM Serverまたは仮想マシンとストレージが通信するためのネットワーク。
それぞれのネットワークセグメントに対して冗長化されたネットワークスイッチを用意すると、3セグメント× 2で合計6つのネットワークスイッチが必要になります。しかし、VLANを適用することで、必要なネットワークスイッチを2台まで削減することができます。それぞれのネットワークスイッチでPublic、Private、Storageに該当するVLANを作成し、相互に接続することで、冗長化された6つのスイッチを仮想的に作り出すことができます。
相互接続については通常のネットワークポートを使用できますが、帯域が気になる場合はポートを束ねるポートアグリゲーションを用いることもできます。ネットワークスイッチがスタッキング用のモジュールを装備していれば、そのモジュールを使って接続することもできます。 
ネットワークスイッチでのVLAN、ポートアグリゲーションの設定方法については、それぞれのネットワークスイッチの製品マニュアルを参照してください。
次にソフトウェアに関するサポート状況を記載します。現在RAC on VM構成でサポートされるデータベース、ゲストOS、Oracle VMは以下の通りです。 
•データベース
下記のデータベースをサポートしています。
Oracle Database 10g Release 2 Update 4（32bit/64bit） 
Oracle Database 11g Release 1 Update 7（32bit/64bit）
＊今回は11g 64bit版を使用します
•ゲストOS
OEL（Oracle Enterprise Linux）5.1以上 かつPVM（準仮想マシン）で構成され 
ていること。
＊今回はオラクルが提供しているOEL 5.3 PVM 64bitのVMテンプレートを使用します
•Oracle VM
Oracle VM 2.1.2以上。
＊今回は執筆時点での最新バージョン2.1.5を使用します
また、注意すべき設定／運用管理上の制約として以下があります。 
・CPUのオーバーコミットは推奨されないが、以下の条件の下でサポートされる
RACを稼働させるGuest VMのVCPUの総和が物理CPUコア数の2倍を超えない
RACを稼働させるGuest VM 1台に割り当てられるVCPUが物理CPUコア数を超 
えない
dom0へのCPU割り当てはデフォルトを維持する
CPU固定割り付けはハードパーティションを行うのでない限りは使用しない
・動的リソース管理はサポートされない
動的なリソース割り当てはサポートされない
Live Migrationはサポートされない
一時停止／再開はサポートされない
これらの制約は、今後オラクルのテスト／開発状況によって変更になる可能性がありますので、最新の情報はMetalink Note: 464754.1を参照ください。