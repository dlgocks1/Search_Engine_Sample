目次
概要 
前提条件 
要件 
使用するコンポーネント 
表記法 
一般分類 
同一ルータ上でのマーキングおよびその他の QoS アクション 
ネットワーク ダイアグラム 
設定例 
NetPro ディスカッション フォーラム：特集対話 
関連情報 
概要
このドキュメントでは、Cisco IOS(R) ソフトウェアが稼働しているルータのインターフェイスでの発着信に Quality of Service（QoS）機能が適用された場合に、どのような順序で実行されるかについて説明しています。QoS ポリシーは、Modular QoS Command Line Interface（MQC; モジュラ QoS コマンドライン インターフェイス）を使用して設定されます。またこのドキュメントでは、DSCP や IP Precedence などの IP ヘッダー マーキングや、ルータによる QoS ポリシー コンポーネントの評価順位についても説明しています。
前提条件
要件
このドキュメントを読むには、次の知識が必要です。
基本的な QoS の方法論
使用するコンポーネント
このドキュメントの「設定例」のセクションの出力例は、Cisco IOS ソフトウェア リリース 12.2 が稼働している Cisco 7513 シリーズ プラットフォームでキャプチャしたものです。
このドキュメントの情報は、特定のラボ環境にあるデバイスに基づいて作成されたものです。このドキュメントで使用するすべてのデバイスは、クリアな（デフォルト）設定で作業を開始しています。対象のネットワークが実稼働中である場合には、どのような作業についても、その潜在的な影響について確実に理解しておく必要があります。
表記法
ドキュメント表記の詳細は、『シスコ テクニカル ティップスの表記法』を参照してください。
一般分類
分類とは、フローのカテゴリ グループにトラフィックを分類するトラフィック クラスを定義するプロセスです。分類では、QoS ポリシーが処理する各トラフィック クラスごとに、「一致基準」が定義されます。明確にいうと、分類とは、サービス ポリシー適用時にパケットがチェックされる「トラフィック フィルタ」を定義することです。
分散プラットフォームと非分散プラットフォームの両方で、ポリシー マップの単一クラスへのパケットの照合が行われます。照合は、最初に一致するクラスが見つかった時点で終了します。ポリシー マップ内の 2 つのクラスが、同じ IP 優先順位または IP アドレス範囲に一致している場合、パケットは常に最初に一致したクラスに属すことになります。このため、ポリシー マップ内のクラス順位は非常に重要です。
この分類方法は「共通分類」と呼ばれ、次の利点があります。
精度の高いアカウンティング、および「共通分類」を適用する前に発生していた重複アカウンティングの回避。
Access Control List（ACL; アクセス制御リスト）のチェックを機能ごとに 1 回ではなく、クラスごとに 1 回実行することによる、CPU への影響の軽減。
キャッシングによる、パケット ヘッダーの検索の迅速化。
service-policy コマンドにより、入力または出力ポリシー マップを添付すると、共通分類は自動的にイネーブルになります。
次表では、共通分類に関する動作の順位を示しています。大切なことは、この表から、QoS 機能のコンテキストでの分類の発生時期を理解することです。着信パスでは、パケットはスイッチング前に分類されます。発信パスでは、パケットはスイッチング後に分類されます。
着信
発信
Border Gateway Protocol（BGP; ボーダー ゲートウェイ プロトコル）を介した QoS ポリシーの伝搬（QPPB）
入力側の共通分類
入力 ACL
入力マーキング（クラスベースのマーキング、または Committed Access Rate（CAR; 専用アクセス レート））
入力ポリシング（クラスベースのポリサーまたは CAR による）
IP セキュリティ（IPSec）
Cisco Express Forwarding（CEF）またはファースト スイッチング
CEF またはファースト スイッチング
出力側の共通分類
出力 ACL
出力マーキング
出力ポリシング（クラスベースのポリサーまたは CAR による）
キューイング（Class-Based Weighted Fair Queueing（CBWFQ）および Low Latency Queueing（LLQ; 低遅延キューイング））、および Weighted Random Early Detection（WRED; 重み付けランダム早期検出）
注：着信側の Network-Based Application Recognition（NBAR）は、ACL の後、ポリシー ベース ルーティングの前で発生します。
機能の順位付けと再マーキング値の使用に関しての重要な変更が適用されました。これら変更には、MQC 出力分類の前への、入力 CAR、入力 MAC、および IP 優先順位アカウンティング機能の実行の移動が含まれています。
入力レート制限（CAR）は、プロセス スイッチング パスに沿って、ルータに着信するパケットに適用されます。以前は、CEF を使ったルータを介して交換されたパケットしかレート制限できませんでした。
入力 CAR や QPPB によって設定された、新しい IP 優先順位の値は、ATM VC バンドルの Virtual Circuit（VC; 仮想回線）の選択に使用できます。
入力 CAR または QPPB によって設定された IP 優先順位、Differentiated Services Code Point（DSCP）、および QoS グループの各値は、MQC 出力パケット分類に使用できます。
同一ルータ上でのマーキングおよびその他の QoS アクション
使用頻度の高い QoS は、パケットを再マーキングして、同一インターフェイスまたは同一ルータ上の再マーキング値と見なされるアクションを適用することです。共通分類では、マーキングと QoS アクションの両方を設定できます。
次の QoS 機能を使って、パケットを再マーキングできます。
クラスベースのマーキングに関する set コマンド
クラスベースのポリシングに関する police コマンド
CAR
次表では、サービス ポリシーの QoS アクションによって、再マーキング値が考慮されるかどうかを示しています。
ポリシーの場所
発信ポリシー アクションが使用する値