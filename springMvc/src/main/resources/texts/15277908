更新日2009/04/22
目的
いろいろな情報がウェブにはあふれていますが、それを自動でとってくるプログラムをよく開発しています。そのとき、基本的にはHTMLフォームを解析して、サーバーに送るデータをつくるのですが、うまく動作しないときがあります。そんなとき、きちんと動作するInternetExplorerなどのブラウザーとサーバーのやり取りをのぞいて、まねをするのが参考になります。
HTTPのやりとりは全てテキストデータなのでその内容が見られればGETやPOSTでデータを送信するときにどういう形式でデータを送るのかよくわかります。これは特にJavaScriptなどをつかっているサイトとの生のデータのやり取りを見ることができ、自動化の手順を考えるときに役立ちます。
手順
tcpdumpをインストール(apt-get install tcpdump)。
root権限で実行する
# tcpcump -XX -s 4098
-sオプションをつけて表示するデータの量を増やさないとHTTPの中身は見られません。
-XXオプションをつけるとどんなデータがやりとりされているか良くわかります。
表示されるデータを絞り込む
# tcpcump -XX -s 4098 'dst www.google.com'
特定のホストに送信しているデータのみを表示します。
# tcpcump -XX -s 4098 'dst www.google.com or src www.google.com'
特定のホストとの送受信データを表示します。