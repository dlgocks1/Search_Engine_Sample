* 7/3 wifi.c の編集箇所が一部不足していたので正しく修正しました。 なんかいろいろやっていたら、GUI での無線LAN接続ができるようになりました。ごちゃごちゃ作業していたので、不要な手順や間違った手順も混じってそうですが、とりあえずメモとして。 まず最低限、前回の作業でコンソールからコマンドを実行して無線LANが使えることを確認すること。無線LANドライバと wpa_supplicant が正常に動作しないと当然 GUI での設定も出来ないので。 次に、android のソースを修正してビルドします。修正するのは hardware/libhardware_legacy/wifi/wifi.c ファイル。 これの最初の方に各種定義をしている部分があるので、そこから static const char IFACE_DIR[] = "/data/system/wifi/wpa_supplicant"; static const char DRIVER_MODULE_NAME[] = "wl"; static const char DRIVER_MODULE_TAG[] = "wl "; static const char DRIVER_MODULE_PATH[] = "/lib/modules/wl.ko"; の四行を、上記のように書き換えます。MODULE_TAG の行は wl の後に半角スペースが入ります。 もう一カ所、(こちらは修正する必要があるかどうか不明ですが、とりあえず修正した状態で動作しているので問題は無いかと・・・) property_set("ctl.start", FIRMWARE_LOADER); という行があるので、これを property_set("ctl.start", 0); と変更します。あとはソースをビルドします。 ビルドが終わったら USB メモリにコピーします。 次に USB メモリの /init.rc ファイルを編集します。 このファイルの 90 行目付近に ## Load some modules というコメントがあるので、その手前に以下の行を追加します。 mkdir /data/misc/wifi 0770 system misc mkdir /data/misc/wifi/sockets 0770 system misc mkdir /data/system/wifi/wpa_supplicant 0770 system misc mkdir /data/misc/dhcp 0770 dhcp dhcp chown dhcp dhcp /data/misc/dhcp 少し進んで、setprop で始まる行が続いているあたりに、以下の行を追加します。 setprop wifi.interface eth1 setprop wlan.driver.status ok 最後に、ファイルの末尾に以下の行を追加します。 service wpa_supplicant /system/bin/logwrapper /system/bin/wpa_supplicant -Dwext -ieth1 -c/system/etc/wifi/wpa_supplicant.conf -dd group wifi service dhcpcd /system/bin/logwrapper dhcpcd -d eth1 disabled oneshot on property:init.svc.wpa_supplicant=stopped stop dhcpcd ＊それぞれを追加する場所はどこでも良いのかもしれませんが、あれこれ試しているうちに場所が変わっていました。ファイルの最後の方は service の定義に使われているので、そこに mkdir などがあるとうまくいかないかもしれません。 あとは /system/etc/wifi/wpa_supplicant.conf を編集します。(AP の設定がすでにされている場合はそれを残したまま、ファイルの先頭に以下の設定を追加します。) update_config=1 ctrl_interface=DIR=/data/system/wpa_supplicant GROUP=system これで保存して android を起動してみると、GUI から接続させることが出来ました。 しかし、一旦接続が切れてしまうと再接続がうまくいかなかったりと、完全では無い様子。でもなんとか使えそうな気配は出てきましたね。